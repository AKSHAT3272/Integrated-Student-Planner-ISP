<!-- templates/calendar.html -->

{% extends "base.html" %}

{% block content %}




<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {

    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
      plugins: [ 'dayGrid', 'timeGrid', 'list', 'bootstrap' ,'interaction'],
      defaultView: 'dayGridMonth',
      timezone: 'UTC',
      themeSystem: 'bootstrap',
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
      },
      navLinks: true,
      selectable: true,
      selectMirror: true,


      select: function(arg) {
        var title = window.prompt('Event title: ');
        //var jsonTitle = '';
        //try to get alertable to work
      /* $.alertable.prompt('Event title:').then(function(title){
          console.log('Title', title);
          title = this.title;
          return title;
        });
       jsonTitle =  JSON.stringify(title.value);
        console.log("Title:", jsonTitle);*/
        if(title){
            calendar.addEvent({
            title: title,
            start: arg.start,
            end: arg.end,
            allDay: arg.allDay
          })
        }
        calendar.unselect()
      },
      editable: true,
      eventClick: function(info) {
      var eventObj = info.event;
      $(".modal").addClass("is-active");


      $(".delete").click(function() {
        $(".modal").removeClass("is-active");
        });
      document.getElementById("title").innerHTML = 'Event: ' + eventObj.title + '.\n ';
      document.getElementById("body").innerHTML = 'Description: ' + info.event.extendedProps.description + '.\n \n';

     /*if (eventObj.url) {
        $.alertable.alert(
          'Event: ' + eventObj.title + '.\n ' +
          'Description: ' + info.event.extendedProps.description + '.\n \n'
          //'Will open ' + eventObj.url + ' in a new tab'
        );}*/
	       if (info.event.url) {
        //  window.open(info.event.url);
    			     }
        info.jsEvent.preventDefault(); // prevents browser from following link in current tab.
      //} else {
      //  alert('Clicked ' + eventObj.title);
    //  }
    },
      weekNumbers: true,
      eventLimit: true, // allow "more" link when too many events
      //events: 'https://fullcalendar.io/demo-events.json'
      //events: '../static/icalexport.json'
	    events: 'static/{{ email }}icalexport.ics.json'
      /*events: [
    {
      title  : 'Senior seminar II',
      start  : '2020-02-17'
    },
    {
      title  : 'Work on ISP',
      start  : '2020-02-18',
      end    : '2020-02-20'
    },
    {
      title  : 'Research conference abstracts due',
      start  : '2020-02-21T12:30:00',
      allDay : false // will make the time show
    }
  ]*/

      /*{url: 'https://moodle.adelphi.edu/calendar/export_execute.php?userid=46823&authtoken=6cba10fe984542e7db46c6aafd7cdb3a8c404f81&preset_what=all&preset_time=custom',
        failure: function() {
          document.getElementById('script-warning').style.display = 'block'
        }
      },
      loading: function(bool) {
        document.getElementById('loading').style.display =
          bool ? 'block' : 'none';
      }*/
    });

    calendar.render();
  });

</script>

<div id="calendar"></div>
<div id='datepicker'></div>

<div class="modal modal-fx-fadeInScale">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head has-background-info" style="padding: 8px;">
      <p class="modal-card-title has-text-white" id="title" style="margin-bottom: 0px;"></p>
      <button class="delete" aria-label="close"></button>
    </header>
    <section class="modal-card-body has-background-light" id="body">
      <!-- Content ... -->
    </section>
  </div>
</div>
{% endblock %}
